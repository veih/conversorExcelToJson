<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Exibição de Dados do Excel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body>
    <div class="container mt-4">
        <input class="btn btn-primary form-control" type="file" id="fileInput" accept=".xlsx">
        <div class="d-flex mt-2">
            <input type="text" id="searchInput" placeholder="Digite para buscar" class="form-control me-2 border border-primary">
            <button type="button" id="searchButton" class="btn btn-primary">Buscar</button>
        </div>
        <pre id="jsonOutput"></pre>
        <div id="tableOutput" class="row row-cols-1 row-cols-md-3 g-4 mt-3"></div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-fullscreen">
            <div class="modal-content">
                <div class="modal-header bg-primary">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Detalhes</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Conteúdo do seu modal aqui -->
                </div>
                <div class="modal-footer bg-primary">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.17.1/dist/xlsx.full.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const fileInput = document.getElementById('fileInput');
            const tableOutput = document.getElementById('tableOutput');
            const searchInput = document.getElementById('searchInput');
            const searchButton = document.getElementById('searchButton');
            const modalTitle = document.querySelector('.modal-title');
            const modalBody = document.querySelector('.modal-body');

            let jsonData = []; // Variável global para armazenar os dados do Excel

            fileInput.addEventListener('change', function (e) {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = function (e) {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const sheetName = workbook.SheetNames[0];
                    const sheet = workbook.Sheets[sheetName];
                    jsonData = XLSX.utils.sheet_to_json(sheet, { header: 1 });

                    console.log(jsonData); // Mostra o JSON gerado no console

                    displayData(jsonData); // Chama a função para exibir os dados inicialmente
                };
                reader.readAsArrayBuffer(file);
            });

            // Evento de clique para o botão de busca
            searchButton.addEventListener('click', function () {
                performSearch();
            });

            // Evento de teclado para o campo de busca
            searchInput.addEventListener('keypress', function (e) {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });

            // Função para realizar a busca
            function performSearch() {
                const searchTerm = searchInput.value.toLowerCase();
                const filteredData = jsonData.filter(row =>
                    row.some(cell => cell && cell.toString().toLowerCase().includes(searchTerm))
                );
                displayData([jsonData[0], ...filteredData]); // Mantém o cabeçalho e adiciona os dados filtrados
            }

            // Função para exibir os dados na tabela de cards
            function displayData(data) {
                let cardHTML = '';
                const headers = data[0]; // Cabeçalhos da tabela
                for (let i = 1; i < data.length; i++) {
                    const cardId = `card-${i}`; // ID único para cada card
                    cardHTML += `
                        <div class="col">
                            <div class="card bg-light shadow">
                                <div class="card-body">
                                    <h5 class="card-title">${data[i][0] !== undefined ? data[i][0] : ''}</h5>
                                    <p class="card-text">${data[i][1] !== undefined ? data[i][1] : ''}</p>
                                    <p class="card-text">${data[i][2] !== undefined ? data[i][2] : ''}</p>
                                    <!-- Button trigger modal -->
                                    <div class="d-grid gap-2">
                                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal" data-card-index="${i}">
                                            Ver
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>`;
                }
                tableOutput.innerHTML = cardHTML;

                // Adicionar evento de clique dinâmico aos botões do card
                const cardButtons = document.querySelectorAll('[data-card-index]');
                cardButtons.forEach(button => {
                    button.addEventListener('click', function () {
                        const cardIndex = button.getAttribute('data-card-index'); // Índice do card na lista de dados
                        const cardData = data[cardIndex]; // Dados do card clicado

                        // Atualizar o conteúdo do modal com as informações do card
                        modalTitle.textContent = cardData[0]; // Título do modal com a primeira coluna do card
                        modalBody.innerHTML = `
                            <div class="container mt-3">
                                <table class="table table-bordered">
                                    <thead class="thead-dark">
                                        <tr>
                                            <th>Campo</th>
                                            <th>Valor</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${headers.map((header, index) => `
                                            <tr>
                                                <th>${header}</th>
                                                <td>${cardData[index] !== undefined ? cardData[index] : ''}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>`;
                    });
                });
            }
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</body>

</html>
